<div class="reservation-hero text-center"
    style="background-image: url('https://images.unsplash.com/photo-1509042239860-f550ce710b93?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');">
    <div class="overlay"></div>
    <div class="content relative z-10">
        <h1 class="text-white">Reserve Table</h1>
        <p class="text-gold subtitle">Book Your Spot. Enjoy the Experience.</p>
    </div>
</div>

<section class="reservation-wizard">

    <div class="wizard-container">

        <!-- Progress Header -->
        <div class="wizard-header" *ngIf="currentStep < 5">
            <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">1. Details</div>
            <div class="line"></div>
            <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">2. Table</div>
            <div class="line"></div>
            <div class="step" [class.active]="currentStep >= 3" [class.completed]="currentStep > 3">3. Menu</div>
            <div class="line"></div>
            <div class="step" [class.active]="currentStep >= 4">4. Confirm</div>
        </div>

        <!-- Step 1: Details -->
        <div class="wizard-step fade-in" *ngIf="currentStep === 1">
            <h2>Booking Details</h2>
            <p class="subtitle">Start your experience with us.</p>

            <form [formGroup]="bookingForm">
                <!-- Date & Time -->
                <div class="form-row">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" formControlName="date">
                    </div>
                </div>

                <div class="form-group">
                    <label>Select Time</label>
                    <div class="time-slots">
                        <button *ngFor="let slot of timeSlots" type="button" class="slot-btn"
                            [class.selected]="bookingForm.get('time')?.value === slot" (click)="selectTime(slot)">
                            {{ slot }}
                        </button>
                    </div>
                    <div *ngIf="bookingForm.get('time')?.invalid && bookingForm.get('time')?.touched" class="error-msg">
                        Please select a time.</div>
                </div>

                <!-- Guests -->
                <div class="form-group centered">
                    <label>Number of Guests</label>
                    <div class="guest-counter">
                        <button type="button" (click)="updateGuests(-1)">-</button>
                        <span>{{ guestCount }}</span>
                        <button type="button" (click)="updateGuests(1)">+</button>
                    </div>
                </div>

                <!-- Contact Info -->
                <div class="contact-fields">
                    <div class="form-group">
                        <label>Name</label>
                        <input type="text" formControlName="name" placeholder="Your Name">
                    </div>
                    <div class="form-group">
                        <label>Phone</label>
                        <input type="tel" formControlName="phone" placeholder="Phone Number">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" formControlName="email" placeholder="Email Address">
                    </div>
                </div>

                <div class="actions">
                    <button class="btn-primary w-100" type="button" (click)="nextStep()">Find Tables</button>
                </div>
            </form>
        </div>

        <!-- Step 2: Table Selection -->
        <div class="wizard-step fade-in" *ngIf="currentStep === 2">
            <h2>Select Your Table</h2>
            <p class="subtitle">Choose a spot for {{ guestCount }} people.</p>

            <div class="table-legend">
                <span class="status available">Available</span>
                <span class="status booked">Booked</span>
                <span class="status disabled">Too Small</span>
            </div>

            <div class="tables-grid">
                <div *ngFor="let table of tables" class="table-card" [class.available]="isTableValid(table)"
                    [class.booked]="table.status === 'booked'"
                    [class.disabled]="!isTableValid(table) && table.status === 'available'"
                    [class.selected]="selectedTable?.id === table.id" (click)="selectTable(table)">
                    <div class="table-icon">ðŸª‘</div>
                    <div class="table-info">
                        <span class="name">{{ table.name }}</span>
                        <span class="cap">{{ table.capacity }} Seats</span>
                        <span class="type">{{ table.type }}</span>
                    </div>
                </div>
            </div>

            <div class="actions row">
                <button class="btn-secondary" (click)="prevStep()">Back</button>
                <button class="btn-primary" [disabled]="!selectedTable" (click)="nextStep()">Next: Pre-order</button>
            </div>
        </div>

        <!-- Step 3: Pre-order -->
        <div class="wizard-step fade-in" *ngIf="currentStep === 3">
            <h2>Pre-order (Optional)</h2>
            <p class="subtitle">Skip the wait. Order your favorites now.</p>

            <div class="menu-grid-small">
                <div class="product-card" *ngFor="let product of products">
                    <div class="prod-img" [style.background-image]="'url(' + product.image + ')'"></div>
                    <div class="prod-info">
                        <h4>{{ product.name }}</h4>
                        <p>${{ product.price }}</p>
                        <button class="btn-add" (click)="addToCart(product)">Add</button>
                    </div>
                </div>
            </div>

            <!-- Sticky Cart Summary -->
            <div class="cart-summary" *ngIf="cart.length > 0">
                <h3>Your Selection</h3>
                <div class="cart-items">
                    <div class="cart-item" *ngFor="let item of cart">
                        <span>{{ item.name }} x{{ item.quantity }}</span>
                        <button class="btn-remove" (click)="removeFromCart(item.id)">-</button>
                    </div>
                </div>
                <div class="cart-total">
                    Total Added: <strong>${{ cartTotal | number:'1.2-2' }}</strong>
                </div>
            </div>

            <div class="actions row">
                <button class="btn-secondary" (click)="prevStep()">Back</button>
                <button class="btn-primary" (click)="nextStep()">Proceed to Checkout</button>
            </div>
        </div>

        <!-- Step 4: Summary -->
        <div class="wizard-step fade-in" *ngIf="currentStep === 4">
            <h2>Confirm Booking</h2>
            <p class="subtitle">Please review your details.</p>

            <div class="summary-card professional-card">
                <div class="card-header">
                    <h3>Reservation Summary</h3>
                    <p class="date">{{ bookingForm.get('date')?.value | date:'fullDate' }}</p>
                </div>

                <div class="card-body">
                    <div class="info-group">
                        <label>Time</label>
                        <div class="value">{{ bookingForm.get('time')?.value }}</div>
                    </div>

                    <div class="info-group">
                        <label>Guests</label>
                        <div class="value">{{ guestCount }} People</div>
                    </div>

                    <div class="info-group highlight">
                        <label>Table</label>
                        <div class="value">{{ selectedTable?.name }} <span class="badge">{{ selectedTable?.type
                                }}</span></div>
                    </div>
                </div>

                <div class="card-divider"></div>

                <div class="card-section" *ngIf="cart.length > 0">
                    <h4>Pre-order Items</h4>
                    <ul class="order-list">
                        <li *ngFor="let item of cart">
                            <span>{{ item.name }} <small>x{{ item.quantity }}</small></span>
                            <span>${{ (item.price * item.quantity) | number:'1.2-2' }}</span>
                        </li>
                    </ul>
                    <div class="total-row">
                        <span>Total Estimate</span>
                        <span>${{ cartTotal | number:'1.2-2' }}</span>
                    </div>
                </div>

                <div class="card-divider"></div>

                <div class="card-footer">
                    <div class="contact-info">
                        <strong>{{ bookingForm.get('name')?.value }}</strong>
                        <p>{{ bookingForm.get('email')?.value }}</p>
                        <p>{{ bookingForm.get('phone')?.value }}</p>
                    </div>
                </div>
            </div>

            <div class="actions row">
                <button class="btn-secondary" (click)="prevStep()">Back</button>
                <button class="btn-primary" (click)="confirmBooking()">Confirm Reservation</button>
            </div>
        </div>

        <!-- Step 5: Success -->
        <div class="wizard-step success-step fade-in" *ngIf="currentStep === 5">
            <div class="success-icon">ðŸŽ‰</div>
            <h2>Booking Confirmed!</h2>
            <p>Your table is successfully booked at CafeEro.</p>
            <div class="booking-id">ID: {{ bookingId }}</div>

            <p class="note">A confirmation email has been sent to {{ bookingForm.get('email')?.value }}.</p>
            <button class="btn-primary" routerLink="/">Return Home</button>
        </div>

    </div>
</section>