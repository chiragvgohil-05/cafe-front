<div class="reservation-hero text-center"
    style="background-image: url('https://images.unsplash.com/photo-1509042239860-f550ce710b93?ixlib=rb-4.0.3&auto=format&fit=crop&w=1920&q=80');">
    <div class="overlay"></div>
    <div class="content">
        <h1>Reserve Your Spot</h1>
        <p class="subtitle">Experience the finest moments</p>
    </div>
</div>

<section class="reservation-wizard">

    <div class="wizard-container">

        <!-- Progress Header -->
        <div class="wizard-header" *ngIf="currentStep < 5">
            <div class="line"></div>
            <div class="step" [class.active]="currentStep >= 1" [class.completed]="currentStep > 1">1. Details</div>
            <div class="step" [class.active]="currentStep >= 2" [class.completed]="currentStep > 2">2. Table</div>
            <div class="step" [class.active]="currentStep >= 3" [class.completed]="currentStep > 3">3. Menu</div>
            <div class="step" [class.active]="currentStep >= 4">4. Confirm</div>
        </div>

        <!-- Error Message -->
        <div *ngIf="errorMessage" class="error-banner fade-in">
            {{ errorMessage }}
        </div>

        <!-- Loader -->
        <div *ngIf="loading" class="loader-overlay fade-in">
            <div class="spinner"></div>
            <p>Processing...</p>
        </div>

        <!-- Step 1: Details -->
        <div class="wizard-step fade-in" *ngIf="currentStep === 1">
            <h2>Booking Details</h2>
            <p class="subtitle">Start your experience with us.</p>

            <form [formGroup]="bookingForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" formControlName="date">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Start Time</label>
                        <input type="time" formControlName="startTime">
                    </div>
                    <div class="form-group">
                        <label>End Time</label>
                        <input type="time" formControlName="endTime">
                    </div>
                </div>

                <!-- Guests -->
                <div class="form-group" style="text-align: center; margin: 30px 0;">
                    <label style="margin-bottom: 15px;">Number of Guests</label>
                    <div class="guest-counter">
                        <button type="button" (click)="updateGuests(-1)">
                            <svg width="12" height="2" viewBox="0 0 12 2" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M0 1H12" />
                            </svg>
                        </button>
                        <span>{{ guestCount }}</span>
                        <button type="button" (click)="updateGuests(1)">
                            <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <path d="M6 0V12M0 6H12" />
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Contact Info -->
                <div class="contact-section" style="margin-top: 40px;">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Full Name</label>
                            <input type="text" formControlName="name" placeholder="Enter your name">
                        </div>
                        <div class="form-group">
                            <label>Phone Number</label>
                            <input type="tel" formControlName="phone" placeholder="+1 (555) 000-0000">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Email Address</label>
                            <input type="email" formControlName="email" placeholder="john@example.com">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Special Request (Optional)</label>
                            <textarea formControlName="specialRequest"
                                placeholder="Any dietary requirements or special occasions?"></textarea>
                        </div>
                    </div>
                </div>

                <div class="actions">
                    <button class="btn-primary w-100" type="button" (click)="nextStep()">Find Available Tables</button>
                </div>
            </form>
        </div>

        <!-- Step 2: Table Selection -->
        <div class="wizard-step fade-in" *ngIf="currentStep === 2">
            <h2>Select Your Table</h2>
            <p class="subtitle">We found these spots for {{ guestCount }} people.</p>

            <div class="tables-grid">
                <div *ngFor="let table of availableTables" class="table-card available"
                    [class.selected]="selectedTable?._id === table._id" (click)="selectTable(table)">

                    <!-- SVG Icon for Table -->
                    <div class="table-icon">
                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" color="#4E342E">
                            <path d="M3 20H21" />
                            <path d="M6 20V12" />
                            <path d="M18 20V12" />
                            <path
                                d="M4 12H20C20.5523 12 21 11.5523 21 11V6C21 5.44772 20.5523 5 20 5H4C3.44772 5 3 5.44772 3 6V11C3 11.5523 3.44772 12 4 12Z" />
                        </svg>
                    </div>

                    <div class="table-info">
                        <span class="name">Table {{ table.tableNumber }}</span>
                        <span class="cap">{{ table.capacity }} Seats</span>
                        <span class="type">{{ table.type }}</span>
                    </div>
                </div>
            </div>

            <div *ngIf="availableTables.length === 0" class="no-tables">
                <p>No tables available matching your criteria.</p>
            </div>

            <div class="actions row">
                <button class="btn-secondary" (click)="prevStep()">Back</button>
                <button class="btn-primary" [disabled]="!selectedTable" (click)="nextStep()">Next Step</button>
            </div>
        </div>

        <!-- Step 3: Pre-order -->
        <div class="wizard-step fade-in" *ngIf="currentStep === 3">
            <h2>Pre-order Menu</h2>
            <p class="subtitle">Optional: Order ahead and skip the wait</p>

            <div class="menu-grid" *ngIf="menuItems.length > 0">
                <div class="menu-card" *ngFor="let item of menuItems">
                    <div class="menu-card-image">
                        <img [src]="item.image || 'https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=400'"
                            [alt]="item.name"
                            (error)="$any($event.target).src='https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?w=400'">
                        <div class="menu-overlay">
                            <button class="btn-add-overlay" (click)="addToCart(item)">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M12 5v14M5 12h14" />
                                </svg>
                                Add to Order
                            </button>
                        </div>
                    </div>
                    <div class="menu-card-content">
                        <h4>{{ item.name }}</h4>
                        <p class="menu-description">{{ item.description || 'Delicious item' }}</p>
                        <div class="menu-footer">
                            <span class="price">\${{ item.price | number:'1.2-2' }}</span>
                            <span class="category-badge">{{ item.category }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="empty-menu" *ngIf="menuItems.length === 0">
                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="1.5">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                </svg>
                <p>No menu items available at the moment</p>
                <small>You can skip this step</small>
            </div>

            <!-- Floating Cart Summary -->
            <div class="cart-floating" *ngIf="cart.length > 0">
                <div class="cart-header">
                    <h3>Your Pre-order ({{ cart.length }} items)</h3>
                    <button class="btn-clear" (click)="cart = []">Clear</button>
                </div>
                <div class="cart-items-list">
                    <div class="cart-item-row" *ngFor="let item of cart">
                        <div class="cart-item-info">
                            <span class="cart-item-name">{{ item.name }}</span>
                            <span class="cart-item-price">\${{ item.price | number:'1.2-2' }}</span>
                        </div>
                        <div class="cart-item-controls">
                            <button class="btn-qty" (click)="removeFromCart(item._id)">-</button>
                            <span class="qty">{{ item.quantity }}</span>
                            <button class="btn-qty" (click)="addToCart(item)">+</button>
                        </div>
                    </div>
                </div>
                <div class="cart-total-row">
                    <span>Subtotal</span>
                    <strong>\${{ cartTotal | number:'1.2-2' }}</strong>
                </div>
            </div>

            <div class="actions row">
                <button class="btn-secondary" (click)="prevStep()">Back</button>
                <button class="btn-primary" (click)="nextStep()">
                    {{ cart.length > 0 ? 'Proceed to Confirm' : 'Skip to Confirm' }}
                </button>
            </div>
        </div>

        <!-- Step 4: Summary -->
        <div class="wizard-step fade-in" *ngIf="currentStep === 4">
            <h2>Confirm Your Reservation</h2>
            <p class="subtitle">Review your booking details before confirmation</p>

            <div class="confirmation-container">
                <!-- Reservation Details Card -->
                <div class="confirm-card">
                    <div class="confirm-header">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                            <line x1="16" y1="2" x2="16" y2="6" />
                            <line x1="8" y1="2" x2="8" y2="6" />
                            <line x1="3" y1="10" x2="21" y2="10" />
                        </svg>
                        <h3>Reservation Details</h3>
                    </div>
                    <div class="confirm-body">
                        <div class="detail-row">
                            <span class="detail-label">Date</span>
                            <span class="detail-value">{{ bookingForm.get('date')?.value | date:'fullDate' }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Time</span>
                            <span class="detail-value">{{ bookingForm.get('startTime')?.value }} - {{
                                bookingForm.get('endTime')?.value }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Guests</span>
                            <span class="detail-value">{{ guestCount }} People</span>
                        </div>
                        <div class="detail-row highlight-row">
                            <span class="detail-label">Table</span>
                            <span class="detail-value">
                                <span class="table-badge">Table {{ selectedTable?.tableNumber }}</span>
                                <span class="table-type">{{ selectedTable?.type }}</span>
                            </span>
                        </div>
                    </div>
                </div>

                <!-- Guest Information Card -->
                <div class="confirm-card">
                    <div class="confirm-header">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                            <circle cx="12" cy="7" r="4" />
                        </svg>
                        <h3>Guest Information</h3>
                    </div>
                    <div class="confirm-body">
                        <div class="detail-row">
                            <span class="detail-label">Name</span>
                            <span class="detail-value">{{ bookingForm.get('name')?.value }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Email</span>
                            <span class="detail-value">{{ bookingForm.get('email')?.value }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Phone</span>
                            <span class="detail-value">{{ bookingForm.get('phone')?.value }}</span>
                        </div>
                        <div class="detail-row" *ngIf="bookingForm.get('specialRequest')?.value">
                            <span class="detail-label">Special Request</span>
                            <span class="detail-value special-req">{{ bookingForm.get('specialRequest')?.value }}</span>
                        </div>
                    </div>
                </div>

                <!-- Pre-order Summary (if items added) -->
                <div class="confirm-card" *ngIf="cart.length > 0">
                    <div class="confirm-header">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <circle cx="9" cy="21" r="1" />
                            <circle cx="20" cy="21" r="1" />
                            <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6" />
                        </svg>
                        <h3>Pre-order Items</h3>
                    </div>
                    <div class="confirm-body">
                        <div class="order-item" *ngFor="let item of cart">
                            <div class="order-item-info">
                                <span class="order-item-name">{{ item.name }}</span>
                                <span class="order-item-qty">Ã— {{ item.quantity }}</span>
                            </div>
                            <span class="order-item-price">\${{ (item.price * item.quantity) | number:'1.2-2' }}</span>
                        </div>
                        <div class="order-total">
                            <span>Subtotal</span>
                            <strong>\${{ cartTotal | number:'1.2-2' }}</strong>
                        </div>
                        <p class="order-note">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10" />
                                <line x1="12" y1="16" x2="12" y2="12" />
                                <line x1="12" y1="8" x2="12.01" y2="8" />
                            </svg>
                            Your order will be prepared upon arrival
                        </p>
                    </div>
                </div>
            </div>

            <div class="actions row">
                <button class="btn-secondary" (click)="prevStep()">Back</button>
                <button class="btn-primary" (click)="confirmBooking()" [disabled]="loading">
                    {{ loading ? 'Processing...' : 'Confirm Reservation' }}
                </button>
            </div>
        </div>

        <!-- Step 5: Success -->
        <div class="wizard-step success-step fade-in" *ngIf="currentStep === 5">
            <div class="success-icon">
                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
                    <polyline points="22 4 12 14.01 9 11.01" />
                </svg>
            </div>
            <h2>Booking Confirmed!</h2>
            <p>Your table has been successfully reserved.</p>
            <div class="booking-id">ID: {{ bookingId }}</div>

            <p class="note">We've sent a confirmation to your email.</p>
            <div class="actions">
                <button class="btn-secondary" routerLink="/my-reservations">View My Reservations</button>
                <button class="btn-primary" routerLink="/">Return Home</button>
            </div>
        </div>

    </div>
</section>