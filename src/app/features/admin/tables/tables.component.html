<div class="tables-container">
    <div class="page-header">
        <div class="header-left">
            <h1>Tables</h1>
            <p class="subtitle">Manage table availability and reservations</p>
        </div>
        <div class="header-right">
            <div class="search-bar">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M11 19C15.4183 19 19 15.4183 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19Z"
                        stroke="#6c757d" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
                    <path d="M21 21L16.65 16.65" stroke="#6c757d" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
                <input type="text" [(ngModel)]="searchTerm" placeholder="Search tables...">
            </div>
            <button class="btn-primary" (click)="openCreateModal()">+ Add Table</button>
        </div>
    </div>

    <!-- Stats Row -->
    <div class="stats-row">
        <div class="stat-box" *ngFor="let stat of tableStats">
            <span class="stat-label">{{ stat.label }}</span>
            <div class="stat-value" [ngClass]="stat.color">{{ stat.value }}</div>
        </div>
    </div>

    <!-- Filter indicators (Legend) -->
    <div class="legend">
        <div class="legend-item"><span class="dot available"></span> Available</div>
        <div class="legend-item"><span class="dot occupied"></span> Occupied</div>
        <div class="legend-item"><span class="dot reserved"></span> Reserved</div>
    </div>

    <!-- Tables Grid -->
    <div class="loading-state" *ngIf="loading">
        Loading tables...
    </div>

    <div class="tables-grid" *ngIf="!loading && filteredTables.length > 0">
        <article class="table-card" *ngFor="let table of filteredTables" [ngClass]="getCardClass(table.status)">
            <div class="card-header-row">
                <span class="status-pill" [ngClass]="getStatusClass(table.status)">
                    <span class="status-dot"></span>
                    {{ table.status | titlecase }}
                </span>
                <button class="icon-btn danger" (click)="openDeleteModal(table)" title="Delete table"
                    aria-label="Delete table">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"></path>
                        <path d="M10 11v6"></path>
                        <path d="M14 11v6"></path>
                        <path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"></path>
                    </svg>
                </button>
            </div>

            <div class="table-identity">
                <div class="table-number-badge">T{{ table.tableNumber }}</div>
                <div class="identity-text">
                    <h3>Table {{ table.tableNumber }}</h3>
                    <p>{{ table.type || 'Standard' }} setup</p>
                </div>
            </div>

            <div class="table-meta-grid">
                <div class="meta-card">
                    <span class="meta-label">Capacity</span>
                    <span class="meta-value">{{ table.capacity }} Seats</span>
                </div>
                <div class="meta-card">
                    <span class="meta-label">Type</span>
                    <span class="meta-value">{{ table.type || 'Standard' }}</span>
                </div>
            </div>

            <div class="card-actions">
                <button class="btn-action primary" (click)="openEditModal(table)">Edit Table</button>
                <button class="btn-action ghost danger" (click)="openDeleteModal(table)">Delete</button>
            </div>
        </article>
    </div>

    <div *ngIf="!loading && filteredTables.length === 0" class="empty-state">
        No tables found. Add one to get started.
    </div>

    <!-- Confirm Delete Modal (Product-style) -->
    <div class="modal-overlay danger" *ngIf="showDeleteModal" (click)="showDeleteModal = false">
        <div class="modal-confirm" (click)="$event.stopPropagation()">
            <div class="danger-icon">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#FF4D4D" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z">
                    </path>
                    <line x1="12" y1="9" x2="12" y2="13"></line>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
            </div>
            <h3>Delete Table</h3>
            <p>Are you sure you want to remove <strong>Table {{ selectedTable?.tableNumber }}</strong>? This action is
                permanent.
            </p>
            <div class="confirm-footer">
                <button class="btn-ghost" (click)="showDeleteModal = false">Keep Table</button>
                <button class="btn-danger-premium" (click)="confirmDelete()" [disabled]="isDeleting">
                    {{ isDeleting ? 'Deleting...' : 'Delete Table' }}
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal Overlay (Add/Edit) -->
<div class="modal-overlay" *ngIf="isModalOpen">
    <div class="modal-content">
        <div class="modal-header">
            <h2>{{ isEditMode ? 'Edit Table' : 'Add New Table' }}</h2>
            <button class="close-btn" (click)="closeModal()">Ã—</button>
        </div>

        <form [formGroup]="tableForm" (ngSubmit)="onSubmit()">
            <div class="modal-body">
                <div class="form-group">
                    <label>Table Number (or ID)</label>
                    <input type="text" formControlName="tableNumber" placeholder="e.g. 1, 12, A1">
                </div>

                <div class="form-group">
                    <label>Capacity (Seats)</label>
                    <input type="number" formControlName="capacity" min="1">
                </div>

                <div class="form-group">
                    <label>Table Type</label>
                    <select formControlName="type">
                        <option value="Standard">Standard</option>
                        <option value="Window">Window</option>
                        <option value="Booth">Booth</option>
                        <option value="Center">Center</option>
                    </select>
                </div>

                <div class="form-group" *ngIf="isEditMode">
                    <label>Status</label>
                    <select formControlName="status">
                        <option value="available">Available</option>
                        <option value="occupied">Occupied</option>
                        <option value="reserved">Reserved</option>
                    </select>
                </div>

                <div class="error-msg" *ngIf="errorMessage">{{ errorMessage }}</div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn-secondary" (click)="closeModal()">Cancel</button>
                <button type="submit" class="btn-primary" [disabled]="loading || tableForm.invalid">
                    {{ loading ? 'Saving...' : 'Save Table' }}
                </button>
            </div>
        </form>
    </div>
</div>
